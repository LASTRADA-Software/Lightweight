<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Lightweight: Best practices</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../resize.js"></script>
<script type="text/javascript" src="../../navtreedata.js"></script>
<script type="text/javascript" src="../../navtree.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
<link href="../../doxygen-awesome.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">Lightweight<span id="projectnumber">&#160;0.1.0</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.8 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "../../search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('../../',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('d2/d10/md__2home_2runner_2work_2Lightweight_2Lightweight_2docs_2best-practices.html','../../'); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Best practices</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="best-practices"></a> </p>
<h1><a class="anchor" id="introduction"></a>
Introduction</h1>
<p>This document provides a set of best practices for using the API. These best practices are based on the experience of the API team and the feedback from the API users as well as learnings from the underlying technologies.</p>
<h1><a class="anchor" id="common-best-practices"></a>
Common best practices</h1>
<h2><a class="anchor" id="use-the-datamapper-api"></a>
Use the DataMapper API</h2>
<p>The <code><a class="el" href="../../dc/dc7/classDataMapper.html" title="Main API for mapping records to and from the database using high level C++ syntax.">DataMapper</a></code> API provides a high-level abstraction for working with database tables. It simplifies the process of querying, inserting, updating, and deleting data from the database while retaining performance and flexibility.</p>
<h2><a class="anchor" id="keep-data-model-and-business-logic-separate"></a>
Keep data model and business logic separate</h2>
<p>Keep the data model and business logic separate to improve the maintainability and scalability of your application.</p>
<p>Remember to also keep frontend (e.g. GUI) and backend (e.g. API) separate.</p>
<h2><a class="anchor" id="use-transactions-with-care"></a>
Use transactions with care</h2>
<p>Use transactions to group multiple database operations into a single unit of work. This ensures that all operations are either committed or rolled back together.</p>
<p>However, be careful when using transactions, as they can affect the performance serverically if not used properly.</p>
<h2><a class="anchor" id="binding-output-parameters"></a>
Binding output parameters</h2>
<p>First things first, always favor using the <code><a class="el" href="../../dc/dc7/classDataMapper.html" title="Main API for mapping records to and from the database using high level C++ syntax.">DataMapper</a></code> API over manual querying and binding of columns.</p>
<p>However, when not using the <code><a class="el" href="../../dc/dc7/classDataMapper.html" title="Main API for mapping records to and from the database using high level C++ syntax.">DataMapper</a></code> API, you need to also retrieve the result manually. Either via <code><a class="el" href="../../df/d17/classSqlStatement.html#ad1b732b98002ac13a593a2c09b057e48">SqlStatement::BindOutputColumns()</a></code> or in post, by fetching the columns individually. It is always highly recommended to pre-bind in order to avoid unnecessary memory allocations and copying.</p>
<p>With this, it is sufficient to call <code><a class="el" href="../../df/d17/classSqlStatement.html#ad1b732b98002ac13a593a2c09b057e48">SqlStatement::BindOutputColumns()</a></code> once one and then you can reuse the result throughout many <code><a class="el" href="../../df/d17/classSqlStatement.html#accc6455ab0d267c65ca911711314c9ec">SqlStatement::FetchRow()</a></code> calls.</p>
<p>The pitfall here is, that if using <code>std::optional&lt;T&gt;</code> column types, you <b>MUST</b> rebind the result columns before each fetch operation, whereas, if not having any nullable values, you do not have to.</p>
<div class="fragment"><div class="line"><span class="keyword">struct </span>MixedNullRow</div>
<div class="line">{</div>
<div class="line">    <a class="code hl_struct" href="../../df/d27/structField.html">Field&lt;SqlGuid, PrimaryKey::AutoAssign&gt;</a> <span class="keywordtype">id</span> {};</div>
<div class="line">    <a class="code hl_struct" href="../../df/d27/structField.html">Field&lt;std::optional&lt;SqlAnsiString&lt;30&gt;</a>&gt;&gt; name;</div>
<div class="line">    <a class="code hl_struct" href="../../df/d27/structField.html">Field&lt;std::optional&lt;int&gt;</a>&gt; age;</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> ForEachData(<a class="code hl_class" href="../../df/d17/classSqlStatement.html">SqlStatement</a>&amp; stmt, <span class="keyword">auto</span>&amp;&amp; onRow)</div>
<div class="line">{</div>
<div class="line">    stmt.<a class="code hl_function" href="../../df/d17/classSqlStatement.html#a945c53d6f2882289703f9ac98f3f171c">ExecuteDirect</a>(stmt.<a class="code hl_function" href="../../df/d17/classSqlStatement.html#ad4db979c5f830dcc838f9b2d9ae8b212">Query</a>(RecordTableName&lt;MixedNullRow&gt;)</div>
<div class="line">                           .<a class="code hl_function" href="../../d0/d78/classSqlQueryBuilder.html#a540942748905edd6045fe8c3fb16a124">Select</a>()</div>
<div class="line">                           .<a class="code hl_function" href="../../d1/d91/classSqlSelectQueryBuilder.html#aa58e6a65bcca55afe0316bcfa1dd60bd">Fields</a>({ <span class="stringliteral">&quot;id&quot;</span>sv, <span class="stringliteral">&quot;name&quot;</span>sv, <span class="stringliteral">&quot;age&quot;</span>sv })</div>
<div class="line">                           .<a class="code hl_function" href="../../d1/d91/classSqlSelectQueryBuilder.html#ab6b6bbe36ee51d4de422c8681266da3d">All</a>());</div>
<div class="line"> </div>
<div class="line">    <span class="keyword">auto</span> currentRow = MixedNullRow {};</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// bind output columns for the first time</span></div>
<div class="line">    stmt.<a class="code hl_function" href="../../df/d17/classSqlStatement.html#ad1b732b98002ac13a593a2c09b057e48">BindOutputColumns</a>(&amp;currentRow.id, &amp;currentRow.name, &amp;currentRow.age);</div>
<div class="line"> </div>
<div class="line">    <span class="keywordflow">while</span> (stmt.<a class="code hl_function" href="../../df/d17/classSqlStatement.html#accc6455ab0d267c65ca911711314c9ec">FetchRow</a>())</div>
<div class="line">    {</div>
<div class="line">        onRow(currentRow);</div>
<div class="line"> </div>
<div class="line">        <span class="comment">// Bind output columns for the next fetch.</span></div>
<div class="line">        <span class="comment">// (ONLY necessary when using std::optional&lt;T&gt; in the columns)</span></div>
<div class="line">        stmt.<a class="code hl_function" href="../../df/d17/classSqlStatement.html#ad1b732b98002ac13a593a2c09b057e48">BindOutputColumns</a>(&amp;currentRow.id, &amp;currentRow.name, &amp;currentRow.age);</div>
<div class="line">    }</div>
<div class="line">}</div>
<div class="ttc" id="aclassSqlQueryBuilder_html_a540942748905edd6045fe8c3fb16a124"><div class="ttname"><a href="../../d0/d78/classSqlQueryBuilder.html#a540942748905edd6045fe8c3fb16a124">SqlQueryBuilder::Select</a></div><div class="ttdeci">LIGHTWEIGHT_API SqlSelectQueryBuilder Select() noexcept</div><div class="ttdoc">Initiates SELECT query building.</div></div>
<div class="ttc" id="aclassSqlSelectQueryBuilder_html_aa58e6a65bcca55afe0316bcfa1dd60bd"><div class="ttname"><a href="../../d1/d91/classSqlSelectQueryBuilder.html#aa58e6a65bcca55afe0316bcfa1dd60bd">SqlSelectQueryBuilder::Fields</a></div><div class="ttdeci">SqlSelectQueryBuilder &amp; Fields(std::string_view const &amp;firstField, MoreFields &amp;&amp;... moreFields)</div><div class="ttdoc">Adds a sequence of columns to the SELECT clause.</div><div class="ttdef"><b>Definition</b> <a href="../../d2/d51/Select_8hpp_source.html#l00175">Select.hpp:175</a></div></div>
<div class="ttc" id="aclassSqlSelectQueryBuilder_html_ab6b6bbe36ee51d4de422c8681266da3d"><div class="ttname"><a href="../../d1/d91/classSqlSelectQueryBuilder.html#ab6b6bbe36ee51d4de422c8681266da3d">SqlSelectQueryBuilder::All</a></div><div class="ttdeci">LIGHTWEIGHT_API ComposedQuery All()</div><div class="ttdoc">Finalizes building the query as SELECT field names FROM ... query.</div></div>
<div class="ttc" id="aclassSqlStatement_html"><div class="ttname"><a href="../../df/d17/classSqlStatement.html">SqlStatement</a></div><div class="ttdoc">High level API for (prepared) raw SQL statements.</div><div class="ttdef"><b>Definition</b> <a href="../../d9/d6e/SqlStatement_8hpp_source.html#l00047">SqlStatement.hpp:48</a></div></div>
<div class="ttc" id="aclassSqlStatement_html_a945c53d6f2882289703f9ac98f3f171c"><div class="ttname"><a href="../../df/d17/classSqlStatement.html#a945c53d6f2882289703f9ac98f3f171c">SqlStatement::ExecuteDirect</a></div><div class="ttdeci">LIGHTWEIGHT_API void ExecuteDirect(std::string_view const &amp;query, std::source_location location=std::source_location::current())</div><div class="ttdoc">Executes the given query directly.</div></div>
<div class="ttc" id="aclassSqlStatement_html_accc6455ab0d267c65ca911711314c9ec"><div class="ttname"><a href="../../df/d17/classSqlStatement.html#accc6455ab0d267c65ca911711314c9ec">SqlStatement::FetchRow</a></div><div class="ttdeci">LIGHTWEIGHT_API bool FetchRow()</div></div>
<div class="ttc" id="aclassSqlStatement_html_ad1b732b98002ac13a593a2c09b057e48"><div class="ttname"><a href="../../df/d17/classSqlStatement.html#ad1b732b98002ac13a593a2c09b057e48">SqlStatement::BindOutputColumns</a></div><div class="ttdeci">void BindOutputColumns(Args *... args)</div></div>
<div class="ttc" id="aclassSqlStatement_html_ad4db979c5f830dcc838f9b2d9ae8b212"><div class="ttname"><a href="../../df/d17/classSqlStatement.html#ad4db979c5f830dcc838f9b2d9ae8b212">SqlStatement::Query</a></div><div class="ttdeci">LIGHTWEIGHT_API SqlQueryBuilder Query(std::string_view const &amp;table={}) const</div><div class="ttdoc">Creates a new query builder for the given table, compatible with the SQL server being connected.</div></div>
<div class="ttc" id="astructField_html"><div class="ttname"><a href="../../df/d27/structField.html">Field</a></div><div class="ttdoc">Represents a single column in a table.</div><div class="ttdef"><b>Definition</b> <a href="../../d6/dac/Field_8hpp_source.html#l00078">Field.hpp:79</a></div></div>
</div><!-- fragment --><h1><a class="anchor" id="sql-driver-related-best-practices"></a>
SQL driver related best practices</h1>
<h2><a class="anchor" id="query-result-row-columns-in-order"></a>
Query result row columns in order</h2>
<p>When querying the result set, always access the columns in the order they are returned by the query. At least MS SQL server driver has issues when accessing columns out of order. Carefully check the driver documentation for the specific behavior of the driver you are using.</p>
<p>This can be avoided when using the <code><a class="el" href="../../dc/dc7/classDataMapper.html" title="Main API for mapping records to and from the database using high level C++ syntax.">DataMapper</a></code> API, which maps the result always in order and as efficient as possible.</p>
<h1><a class="anchor" id="performance-is-key"></a>
Performance is key</h1>
<h2><a class="anchor" id="use-native-column-types"></a>
Use native column types</h2>
<p>Use the native column types provided by the API for the columns in your tables. This will help to improve the performance of your application by reducing the overhead of data conversion.</p>
<p>The existence of <code><a class="el" href="../../d0/df8/structSqlVariant.html" title="Represents a value that can be any of the supported SQL data types.">SqlVariant</a></code> in the API allows you to store any type of data in a single column, but it is recommended to use the native column types whenever possible.</p>
<h2><a class="anchor" id="use-prepared-statements"></a>
Use prepared statements</h2>
<p>Prepared statements are precompiled SQL statements that can be executed multiple times with different parameters. Using prepared statements can improve the performance of your application by reducing the overhead of parsing, analyzing, and compiling the SQL queries.</p>
<h2><a class="anchor" id="use-pagination-or-infinite-scrolling"></a>
Use pagination or infinite scrolling</h2>
<p>When querying large result sets, use pagination or infinite scrolling to limit the number of results returned in a single response. This will help to reduce the response time and the load on the server and improve the performance of your application.</p>
<h1><a class="anchor" id="sql-server-variation-challenges"></a>
SQL server variation challenges</h1>
<h2><a class="anchor" id="autotoc_md64-bit-integer-handling-in-oracle-database"></a>
64-bit integer handling in Oracle database</h2>
<p>Oracle database does not support 64-bit integers natively. When working with 64-bit integers in Oracle database, you need to use the <code><a class="el" href="../../da/d72/structSqlNumeric.html">SqlNumeric</a></code> column types. </p>
</div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="../../doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.8 </li>
  </ul>
</div>
</body>
</html>
