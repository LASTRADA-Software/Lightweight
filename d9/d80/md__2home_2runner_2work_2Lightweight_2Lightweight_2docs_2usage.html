<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" lang="en-US">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=11"/>
<meta name="generator" content="Doxygen 1.9.8"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>Lightweight: Usage Examples</title>
<link href="../../tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../jquery.js"></script>
<script type="text/javascript" src="../../dynsections.js"></script>
<link href="../../navtree.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../resize.js"></script>
<script type="text/javascript" src="../../navtreedata.js"></script>
<script type="text/javascript" src="../../navtree.js"></script>
<link href="../../search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="../../search/searchdata.js"></script>
<script type="text/javascript" src="../../search/search.js"></script>
<link href="../../doxygen.css" rel="stylesheet" type="text/css" />
<link href="../../doxygen-awesome.css" rel="stylesheet" type="text/css"/>
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr id="projectrow">
  <td id="projectalign">
   <div id="projectname">Lightweight<span id="projectnumber">&#160;0.20250904.0</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.9.8 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
var searchBox = new SearchBox("searchBox", "../../search/",'.html');
/* @license-end */
</script>
<script type="text/javascript" src="../../menudata.js"></script>
<script type="text/javascript" src="../../menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(function() {
  initMenu('../../',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */
</script>
<div id="main-nav"></div>
</div><!-- top -->
<div id="side-nav" class="ui-resizable side-nav-resizable">
  <div id="nav-tree">
    <div id="nav-tree-contents">
      <div id="nav-sync" class="sync"></div>
    </div>
  </div>
  <div id="splitbar" style="-moz-user-select:none;" 
       class="ui-resizable-handle">
  </div>
</div>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:d3d9a9a6595521f9666a5e94cc830dab83b65699&amp;dn=expat.txt MIT */
$(document).ready(function(){initNavTree('d9/d80/md__2home_2runner_2work_2Lightweight_2Lightweight_2docs_2usage.html','../../'); initResizable(); });
/* @license-end */
</script>
<div id="doc-content">
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<div id="MSearchResults">
<div class="SRPage">
<div id="SRIndex">
<div id="SRResults"></div>
<div class="SRStatus" id="Loading">Loading...</div>
<div class="SRStatus" id="Searching">Searching...</div>
<div class="SRStatus" id="NoMatches">No Matches</div>
</div>
</div>
</div>
</div>

<div><div class="header">
  <div class="headertitle"><div class="title">Usage Examples</div></div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p><a class="anchor" id="usage-examples"></a> </p>
<h1><a class="anchor" id="configure-default-connection-information-to-the-database"></a>
Configure default connection information to the database</h1>
<p>To connect to the database you need to provide connection string that library uses to establish connection and you can check if it is alive in the following way </p><div class="fragment"><div class="line">SqlConnection::SetDefaultConnectionString(SqlConnectionString { </div>
<div class="line">    .value = std::format(<span class="stringliteral">&quot;DRIVER=SQLite3;Database=test.sqlite&quot;</span>)</div>
<div class="line">});</div>
<div class="line"> </div>
<div class="line"><span class="keyword">auto</span> sqlConnection = SqlConnection {};</div>
<div class="line"><span class="keywordflow">if</span> (!sqlConnection.IsAlive())</div>
<div class="line">{</div>
<div class="line">    std::println(<span class="stringliteral">&quot;Failed to connect to the database: {}&quot;</span>,</div>
<div class="line">                 SqlErrorInfo::fromConnectionHandle(sqlConnection.NativeHandle()));</div>
<div class="line">    std::abort();</div>
<div class="line">}</div>
</div><!-- fragment --><h1><a class="anchor" id="raw-sql-queries"></a>
Raw SQL Queries</h1>
<p>To directly make a call to the database use <code>ExecuteDirect</code> function, for example </p><div class="fragment"><div class="line"><span class="keyword">auto</span> stmt = SqlStatement {};</div>
<div class="line">stmt.ExecuteDirect(R<span class="stringliteral">&quot;(&quot;SELECT &quot;a&quot;, &quot;b&quot;, &quot;c&quot; FROM &quot;That&quot; ORDER BY &quot;That&quot;.&quot;b&quot; DESC)&quot;));</span></div>
<div class="line"><span class="stringliteral"></span><span class="keywordflow">while</span> (stmt.FetchRow())</div>
<div class="line">{</div>
<div class="line">   <span class="keyword">auto</span> a = stmt.GetColumn&lt;<span class="keywordtype">int</span>&gt;(1);</div>
<div class="line">   <span class="keyword">auto</span> b = stmt.GetColumn&lt;<span class="keywordtype">int</span>&gt;(2);</div>
<div class="line">   <span class="keyword">auto</span> c = stmt.GetColumn&lt;<span class="keywordtype">int</span>&gt;(3);</div>
<div class="line">   std::println(<span class="stringliteral">&quot;{}|{}|{}&quot;</span>, a, b,c);</div>
<div class="line">}</div>
</div><!-- fragment --><h1><a class="anchor" id="prepared-statements"></a>
Prepared Statements</h1>
<p>You can also use prepared statements to execute queries, for example </p><div class="fragment"><div class="line"><span class="keyword">struct </span>Record { <span class="keywordtype">int</span> a; <span class="keywordtype">int</span> b; <span class="keywordtype">int</span> c; };</div>
<div class="line"><span class="keyword">auto</span> conn = SqlConnection {};</div>
<div class="line"><span class="keyword">auto</span> stmt = SqlStatement { conn };</div>
<div class="line">stmt.Prepare(<span class="stringliteral">&quot;SELECT a, b, c FROM That WHERE a = ? OR b = ?&quot;</span>);</div>
<div class="line">stmt.Execute(42, 43);</div>
<div class="line"> </div>
<div class="line">SqlResultCursor cursor = stmt.GetResultCursor();</div>
<div class="line"><span class="keyword">auto</span> record = Record {};</div>
<div class="line">cursor.BindOutputColumns&lt;Record&gt;(&amp;record.a, &amp;rcord.b, &amp;record.c);</div>
<div class="line"><span class="keywordflow">while</span> (cursor.FetchRow())</div>
<div class="line">    std::println(<span class="stringliteral">&quot;{}|{}|{}&quot;</span>, a, b, c);</div>
</div><!-- fragment --><h1><a class="anchor" id="sql-query-builder"></a>
SQL Query Builder</h1>
<p>Or construct statement using <code>SqlQueryBuilder</code> </p><div class="fragment"><div class="line"><span class="keyword">auto</span> stmt = SqlStatement { };</div>
<div class="line"><span class="keyword">auto</span> <span class="keyword">const</span> sqlQuery =  stmt.Query(<span class="stringliteral">&quot;That&quot;</span>)</div>
<div class="line">                .Select()</div>
<div class="line">                .Fields(<span class="stringliteral">&quot;a&quot;</span>, <span class="stringliteral">&quot;b&quot;</span>)</div>
<div class="line">                .Field(<span class="stringliteral">&quot;c&quot;</span>)</div>
<div class="line">                .OrderBy(SqlQualifiedTableColumnName { .tableName = <span class="stringliteral">&quot;That&quot;</span>, .columnName = <span class="stringliteral">&quot;b&quot;</span> },</div>
<div class="line">                         SqlResultOrdering::DESCENDING)</div>
<div class="line">                .All()</div>
<div class="line">stmt.Prepare(sqlQuery);</div>
<div class="line">stmt.Execute();</div>
<div class="line"> </div>
<div class="line"><span class="keywordflow">while</span>(stmt.FetchRow())</div>
<div class="line">{</div>
<div class="line">    <span class="keyword">auto</span> a = stmt.GetColumn&lt;<span class="keywordtype">int</span>&gt;(1);</div>
<div class="line">    <span class="keyword">auto</span> b = stmt.GetColumn&lt;<span class="keywordtype">int</span>&gt;(2);</div>
<div class="line">    <span class="keyword">auto</span> c = stmt.GetColumn&lt;<span class="keywordtype">int</span>&gt;(3);</div>
<div class="line">}</div>
</div><!-- fragment --><p>For more info see <code>SqlQuery</code> and <code>SqlQueryFormatter</code> documentation</p>
<h1><a class="anchor" id="high-level-data-mapping"></a>
High level Data Mapping</h1>
<p>The <code>DataMapper</code> provides a higher-level abstraction for interacting with databases. It simplifies operations by automatically creating tables based on the specified type and enabling data retrieval through straightforward method calls. For more info see <code>DataMapper</code> documentation </p><div class="fragment"><div class="line"><span class="comment">// Define a person structure, mapping to a table</span></div>
<div class="line"><span class="comment">// The field members are mapped to the columns in the table,</span></div>
<div class="line"><span class="comment">// and the Field&lt;&gt; template parameter specifies the type of the column.</span></div>
<div class="line"><span class="comment">// Field&lt;&gt; is also used to track what fields are modified and need to be updated.</span></div>
<div class="line"><span class="keyword">struct </span>Person</div>
<div class="line">{</div>
<div class="line">    Field&lt;SqlGuid, PrimaryKey::AutoAssign&gt; id;</div>
<div class="line">    Field&lt;SqlAnsiString&lt;25&gt;&gt; name;</div>
<div class="line">    Field&lt;bool&gt; is_active { <span class="keyword">true</span> };</div>
<div class="line">    Field&lt;std::optional&lt;int&gt;&gt; age;</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> CRUD(DataMapper&amp; dm)</div>
<div class="line">{</div>
<div class="line">    <span class="comment">// Creates the table if it does not exist</span></div>
<div class="line">    dm.CreateTable&lt;Person&gt;();</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Create a new person</span></div>
<div class="line">    <span class="keyword">auto</span> person = Person {};</div>
<div class="line">    person.name = <span class="stringliteral">&quot;John Doe&quot;</span>;</div>
<div class="line">    person.is_active = <span class="keyword">true</span>;</div>
<div class="line">    dm.Create(person);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Update the person</span></div>
<div class="line">    person.age = 25;</div>
<div class="line">    dm.Update(person);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Query the person</span></div>
<div class="line">    <span class="keywordflow">if</span> (<span class="keyword">auto</span> <span class="keyword">const</span> po = dm.QuerySingle&lt;Person&gt;(person.id); po)</div>
<div class="line">        std::println(<span class="stringliteral">&quot;Person: {} ({})&quot;</span>, po-&gt;name, DataMapper::Inspect(*po));</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Query all persons</span></div>
<div class="line">    <span class="keyword">auto</span> <span class="keyword">const</span> persons = dm.Query&lt;Person&gt;(); </div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Iterate over all persons </span></div>
<div class="line">    <span class="keyword">auto</span> stmt = SqlStatement { dm.Connection() };</div>
<div class="line">    <span class="keywordflow">for</span>(<span class="keyword">const</span> <span class="keyword">auto</span>&amp; person: SqlRowIterator&lt;Person&gt;(stmt))</div>
<div class="line">        std::println(<span class="stringliteral">&quot;|{}|{}|&quot;</span>, person.name, person.age);</div>
<div class="line"> </div>
<div class="line">    <span class="comment">// Delete the person</span></div>
<div class="line">    dm.Delete(person);</div>
<div class="line">}</div>
</div><!-- fragment --><h1><a class="anchor" id="simple-row-retrieval-via-structs"></a>
Simple row retrieval via structs</h1>
<p>When only read access is needed, you can use a simple <code>struct</code> to represent the row, and also do not need to wrap the fields into <code>Field&lt;&gt;</code> template. The <code>struct</code> must have fields that match the columns in the query. The fields can be of any type that can be converted from the column type. The struct can have more fields than the columns in the query, but the fields that match the columns must be in the same order as the columns in the query.</p>
<div class="fragment"><div class="line"><span class="keyword">struct </span>SimpleStruct</div>
<div class="line">{</div>
<div class="line">    uint64_t pkFromA;</div>
<div class="line">    uint64_t pkFromB;</div>
<div class="line">    SqlAnsiString&lt;30&gt; c1FromA;</div>
<div class="line">    SqlAnsiString&lt;30&gt; c2FromA;</div>
<div class="line">    SqlAnsiString&lt;30&gt; c1FromB;</div>
<div class="line">    SqlAnsiString&lt;30&gt; c2FromB;</div>
<div class="line">};</div>
<div class="line"> </div>
<div class="line"><span class="keywordtype">void</span> SimpleStructExample(DataMapper&amp; dm)</div>
<div class="line">{</div>
<div class="line">    <span class="keywordflow">if</span> (<span class="keyword">auto</span> maybeObject = dm.Query&lt;SimpleString&gt;(</div>
<div class="line">        <span class="stringliteral">&quot;SELECT A.pk, B.pk, A.c1, A.c2, B.c1, B.c2 FROM A LEFT JOIN B ON A.pk = B.pk&quot;</span>); maybeObject)</div>
<div class="line">    ))</div>
<div class="line">    {</div>
<div class="line">        <span class="keywordflow">for</span> (<span class="keyword">auto</span> <span class="keyword">const</span>&amp; obj : *maybeObject)</div>
<div class="line">            std::println(<span class="stringliteral">&quot;{}&quot;</span>, DataMapper::Inspect(obj));</div>
<div class="line">    }</div>
<div class="line">}</div>
</div><!-- fragment --> </div></div><!-- contents -->
</div><!-- PageDoc -->
</div><!-- doc-content -->
<!-- start footer part -->
<div id="nav-path" class="navpath"><!-- id is needed for treeview function! -->
  <ul>
    <li class="footer">Generated by <a href="https://www.doxygen.org/index.html"><img class="footer" src="../../doxygen.svg" width="104" height="31" alt="doxygen"/></a> 1.9.8 </li>
  </ul>
</div>
</body>
</html>
